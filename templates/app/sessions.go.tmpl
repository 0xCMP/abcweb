package app

import "github.com/volatiletech/abcsessions"

// InitSessions initializes the sessions Overseer
func (s *State) InitSessions() {
	// Configure cookie options
	opts := abcsessions.NewCookieOptions()
	// If not using HTTPS, disable cookie secure flag
	if len(s.AppConfig.TLSBind) == 0 {
		opts.Secure = false
	}

	if s.AppConfig.SessionsDevStorer {
		s.Session = abcsessions.NewCookieOverseer(opts, []byte("{{randString 32}}"))
	} else {
		storer, err := abcsessions.NewDefaultDiskStorer("{{randString 8}}")
		if err != nil {
			panic(err)
		}
		storer.StartCleaner()
		s.Session = abcsessions.NewStorageOverseer(opts, storer)
	}
}
